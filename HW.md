# Домашнее задание

Требовалось улучшить качество рекоммендеров, чтобы победить модель с семинаров.

Сначала были проведены эксперименты с варьированием архитектуры нейросетевого рекоммендера -- увеличение размерности эмбеддингов, использование общих эмбеддингов для контекста и треков, обучение на фильтрованных данных (все пары, у которых время прослушивания менее порога, отбрасывались). Однако, это не дало значимого положительного эффекта.

Повысить качество удалось с той же самой архитектурой, но с учётом истории прослушиваний для каждого пользователя.

Более подробное описание подхода: для каждого пользователя хранятся $N$ последних треков, которые были ему рекомендованы, и время, которое он их слушал. При каждом запросе на новую рекомендацию, алгоритм находит среди последних треков ту песню, которую пользователь слушал дольше всего, и выбирает из рекомендаций для неё.

Для каждого трека есть довольно много рекомендаций, а $N$ взято равным 10, так что специальной обработки для защиты от повторов нет. Тем не менее, это подход значительно улучшает среднее время сессии и среднее число треков.

## Создание окружения

```
conda create -n botify python=3.7
conda activate botify

which pip
# ensure you use pip from the environment

cd recsys-itmo-spring-2023
pip install -r botify/requirements.txt
pip install -r sim/requirements.txt
pip install jupyter ipykernel
```

## Воспроизведение

Оба нейросетевых рекоммендера используют файл `tracks_with_recs.json`, полученный на 4 семинаре.

Запускаем контейнер с ботом:

```
cd botify
docker-compose up -d --build

# check the logs
docker logs recommender-container
```

Запускаем A/B-эксперимент:

```
cd ../sim
python sim/run.py --episodes 2000 --config config/env.yml single --recommender remote --seed 31337
docker cp recommender-container:/app/log/data.json ../tmp/ab_with_memory.json
```

Используем ноутбук `Week1Seminar.ipynb` для визуализации результатов.